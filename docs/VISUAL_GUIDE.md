# ğŸ¨ Visual Guide: How Prisma & PostgreSQL Work Together

## ğŸ“Š The Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     YOUR NESTJS BACKEND                      â”‚
â”‚                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  ProductService.ts                                     â”‚ â”‚
â”‚  â”‚                                                        â”‚ â”‚
â”‚  â”‚  async getProducts() {                                â”‚ â”‚
â”‚  â”‚    return this.prisma.product.findMany()  â† TypeScriptâ”‚ â”‚
â”‚  â”‚  }                                                     â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                          â”‚                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  Prisma Client                                        â”‚ â”‚
â”‚  â”‚  (Generated from schema.prisma)                       â”‚ â”‚
â”‚  â”‚                                                        â”‚ â”‚
â”‚  â”‚  â€¢ Type-safe TypeScript API                          â”‚ â”‚
â”‚  â”‚  â€¢ Converts TypeScript â†’ SQL                         â”‚ â”‚
â”‚  â”‚  â€¢ Converts SQL results â†’ TypeScript objects         â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                 SQL Query (generated by Prisma)
                 SELECT * FROM "Product" WHERE "isActive" = true;
                             â”‚
                             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚               DOCKER CONTAINER: eshop-postgres               â”‚
â”‚                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  PostgreSQL Database Server                          â”‚  â”‚
â”‚  â”‚                                                       â”‚  â”‚
â”‚  â”‚  Database: eshop_dev                                 â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚
â”‚  â”‚  â”‚  Table: Product                                 â”‚ â”‚  â”‚
â”‚  â”‚  â”‚                                                 â”‚ â”‚  â”‚
â”‚  â”‚  â”‚  id  â”‚ name         â”‚ price  â”‚ stock â”‚ ...    â”‚ â”‚  â”‚
â”‚  â”‚  â”‚  â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”‚ â”‚  â”‚
â”‚  â”‚  â”‚  1   â”‚ Headphones   â”‚ 89.99  â”‚ 45    â”‚ ...    â”‚ â”‚  â”‚
â”‚  â”‚  â”‚  2   â”‚ Smart Watch  â”‚ 249.99 â”‚ 28    â”‚ ...    â”‚ â”‚  â”‚
â”‚  â”‚  â”‚  3   â”‚ Speaker      â”‚ 59.99  â”‚ 67    â”‚ ...    â”‚ â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                              â”‚
â”‚  Stored on your computer's disk in:                         â”‚
â”‚  Docker Volume: e-shop_postgres_data                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”„ Request Flow Example

**When you call: `GET /products`**

```
1. Browser/Frontend
   â”‚
   â”‚ HTTP Request: GET /products
   â”‚
   â–¼
2. NestJS Controller
   â”‚
   â”‚ @Get('products')
   â”‚ async getProducts() {
   â”‚   return this.productService.findAll();
   â”‚ }
   â”‚
   â–¼
3. Product Service
   â”‚
   â”‚ async findAll() {
   â”‚   return this.prisma.product.findMany({
   â”‚     where: { isActive: true }
   â”‚   });
   â”‚ }
   â”‚
   â–¼
4. Prisma Client
   â”‚
   â”‚ Converts TypeScript to SQL:
   â”‚ SELECT * FROM "Product" WHERE "isActive" = true;
   â”‚
   â–¼
5. PostgreSQL Database
   â”‚
   â”‚ Executes SQL query
   â”‚ Retrieves matching rows
   â”‚ Returns data
   â”‚
   â–¼
6. Prisma Client
   â”‚
   â”‚ Converts SQL results to TypeScript:
   â”‚ [
   â”‚   { id: 1, name: 'Headphones', price: 89.99, ... },
   â”‚   { id: 2, name: 'Smart Watch', price: 249.99, ... }
   â”‚ ]
   â”‚
   â–¼
7. NestJS Controller
   â”‚
   â”‚ Returns JSON response
   â”‚
   â–¼
8. Browser/Frontend
   â”‚
   â”‚ Displays products to user
```

---

## ğŸ“ File Structure Explained

```
e-shop/
â”‚
â”œâ”€â”€ docker-compose.yml              â† Defines PostgreSQL container
â”‚   (Think: "Recipe for running the database")
â”‚
â”œâ”€â”€ backend/
â”‚   â”‚
â”‚   â”œâ”€â”€ .env                        â† Secret connection string
â”‚   â”‚   DATABASE_URL=postgresql://user:pass@localhost:5432/db
â”‚   â”‚   (Think: "How to reach the database")
â”‚   â”‚
â”‚   â”œâ”€â”€ prisma.config.ts            â† Prisma CLI configuration
â”‚   â”‚   (Think: "Settings for Prisma tools")
â”‚   â”‚
â”‚   â”œâ”€â”€ prisma/
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ schema.prisma           â† Database blueprint
â”‚   â”‚   â”‚   model Product {         (Think: "Table design")
â”‚   â”‚   â”‚     id    Int
â”‚   â”‚   â”‚     name  String
â”‚   â”‚   â”‚     price Decimal
â”‚   â”‚   â”‚   }
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ seed.ts                 â† Sample data script
â”‚   â”‚   â”‚   (Think: "Fill database with test products")
â”‚   â”‚   â”‚
â”‚   â”‚   â””â”€â”€ migrations/             â† Database change history
â”‚   â”‚       â””â”€â”€ 20260113_init/
â”‚   â”‚           â””â”€â”€ migration.sql   (Think: "SQL commands executed")
â”‚   â”‚
â”‚   â””â”€â”€ node_modules/
â”‚       â””â”€â”€ @prisma/client/         â† Auto-generated Prisma code
â”‚           (Think: "TypeScript API for your database")
```

---

## ğŸ¯ Common Tasks Visualized

### Task: Add New Product

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Your Code           â”‚
â”‚                     â”‚
â”‚ prisma.product      â”‚
â”‚   .create({         â”‚
â”‚     data: {         â”‚
â”‚       name: "Mug",  â”‚
â”‚       price: 15.99  â”‚
â”‚     }               â”‚
â”‚   })                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â–¼
    Prisma generates SQL:
    INSERT INTO "Product"
    ("name", "price")
    VALUES ('Mug', 15.99)
           â”‚
           â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ PostgreSQL   â”‚
    â”‚ Saves to     â”‚
    â”‚ disk         â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### Task: Change Schema (Add Column)

```
Step 1: Edit schema.prisma
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ model Product {      â”‚
â”‚   ...                â”‚
â”‚   brand  String?  â† ADD THIS
â”‚ }                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Step 2: Create Migration
$ npx prisma migrate dev --name add_brand

Step 3: Prisma Does This
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. Detects change in schema         â”‚
â”‚ 2. Generates SQL:                   â”‚
â”‚    ALTER TABLE "Product"            â”‚
â”‚    ADD COLUMN "brand" TEXT;         â”‚
â”‚ 3. Executes SQL on database         â”‚
â”‚ 4. Saves SQL to migrations/         â”‚
â”‚ 5. Regenerates Prisma Client        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Result:
âœ… Database updated
âœ… TypeScript types updated
âœ… You can now use product.brand in code
```

---

## ğŸ§ª Interactive Learning Path

### Level 1: View Data
```bash
cd backend
npx prisma studio
```
â†’ Opens GUI, click around, see your data!

### Level 2: Query Data (in code)
```typescript
// Get all products
const all = await prisma.product.findMany();

// Get one product
const one = await prisma.product.findUnique({ 
  where: { id: 1 } 
});

// Search products
const cheap = await prisma.product.findMany({
  where: { 
    price: { lt: 50 }  // less than $50
  }
});
```

### Level 3: Modify Data
```typescript
// Create
await prisma.product.create({
  data: { name: "New Product", price: 99.99, stock: 10 }
});

// Update
await prisma.product.update({
  where: { id: 1 },
  data: { price: 79.99 }
});

// Delete
await prisma.product.delete({
  where: { id: 1 }
});
```

### Level 4: Complex Queries
```typescript
// Count
const count = await prisma.product.count();

// Group by
const byCategory = await prisma.product.groupBy({
  by: ['category'],
  _count: true
});

// Order by
const sorted = await prisma.product.findMany({
  orderBy: { price: 'asc' }
});

// Pagination
const page2 = await prisma.product.findMany({
  skip: 10,
  take: 10
});
```

---

## ğŸ¤” FAQ

**Q: What happens if I change schema.prisma?**
A: Nothing until you run `npx prisma migrate dev`. That's when Prisma updates the database.

**Q: Can I lose data?**
A: Migrations are safe. But `prisma migrate reset` deletes everything!

**Q: Do I need to restart my server after migrations?**
A: No! But the server will auto-restart in watch mode anyway.

**Q: What if I delete node_modules/@prisma/client?**
A: Just run `npx prisma generate` to regenerate it.

**Q: Can I edit migrations after creating them?**
A: Not recommended. Create a new migration instead.

---

## ğŸ“ Next Steps

1. âœ… Read this guide
2. âœ… Open Prisma Studio and explore
3. â­ï¸ Build your first API endpoint using Prisma
4. â­ï¸ Try querying data from frontend

**Ready to build the Product API?** Let me know! ğŸš€
